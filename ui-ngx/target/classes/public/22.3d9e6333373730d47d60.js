(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{RV8Q:function(t,i,e){"use strict";e.d(i,"d",(function(){return o})),e.d(i,"c",(function(){return l})),e.d(i,"b",(function(){return r})),e.d(i,"a",(function(){return h}));var s=e("mrSG");function o(t){var i={schema:{type:"object",title:"Settings",properties:{}}},e=i.schema.properties;return e.stack={title:"Stacking",type:"boolean",default:!1},"graph"===t&&(e.smoothLines={title:"Display smooth (curved) lines",type:"boolean",default:!1}),"bar"===t&&(e.defaultBarWidth={title:"Default bar width for non-aggregated data (milliseconds)",type:"number",default:600},e.barAlignment={title:"Bar alignment",type:"string",default:"left"}),"graph"!==t&&"bar"!==t||(e.thresholdsLineWidth={title:"Default line width for all thresholds",type:"number"}),e.shadowSize={title:"Shadow size",type:"number",default:4},e.fontColor={title:"Font color",type:"string",default:"#545454"},e.fontSize={title:"Font size",type:"number",default:10},e.tooltipIndividual={title:"Hover individual points",type:"boolean",default:!1},e.tooltipCumulative={title:"Show cumulative values in stacking mode",type:"boolean",default:!1},e.tooltipValueFormatter={title:"Tooltip value format function, f(value)",type:"string",default:""},e.hideZeros={title:"Hide zero/false values from tooltip",type:"boolean",default:!1},e.grid={title:"Grid settings",type:"object",properties:{color:{title:"Primary color",type:"string",default:"#545454"},backgroundColor:{title:"Background color",type:"string",default:null},tickColor:{title:"Ticks color",type:"string",default:"#DDDDDD"},outlineWidth:{title:"Grid outline/border width (px)",type:"number",default:1},verticalLines:{title:"Show vertical lines",type:"boolean",default:!0},horizontalLines:{title:"Show horizontal lines",type:"boolean",default:!0}}},e.xaxis={title:"X axis settings",type:"object",properties:{showLabels:{title:"Show labels",type:"boolean",default:!0},title:{title:"Axis title",type:"string",default:null},color:{title:"Ticks color",type:"string",default:null}}},e.yaxis={title:"Y axis settings",type:"object",properties:{min:{title:"Minimum value on the scale",type:"number",default:null},max:{title:"Maximum value on the scale",type:"number",default:null},showLabels:{title:"Show labels",type:"boolean",default:!0},title:{title:"Axis title",type:"string",default:null},color:{title:"Ticks color",type:"string",default:null},ticksFormatter:{title:"Ticks formatter function, f(value)",type:"string",default:""},tickDecimals:{title:"The number of decimals to display",type:"number",default:0},tickSize:{title:"Step size between ticks",type:"number",default:null}}},i.schema.required=[],i.form=["stack"],"graph"===t&&i.form.push("smoothLines"),"bar"===t&&(i.form.push("defaultBarWidth"),i.form.push({key:"barAlignment",type:"rc-select",multiple:!1,items:[{value:"left",label:"Left"},{value:"right",label:"Right"},{value:"center",label:"Center"}]})),"graph"!==t&&"bar"!==t||i.form.push("thresholdsLineWidth"),i.form.push("shadowSize"),i.form.push({key:"fontColor",type:"color"}),i.form.push("fontSize"),i.form.push("tooltipIndividual"),i.form.push("tooltipCumulative"),i.form.push({key:"tooltipValueFormatter",type:"javascript"}),i.form.push("hideZeros"),i.form.push({key:"grid",items:[{key:"grid.color",type:"color"},{key:"grid.backgroundColor",type:"color"},{key:"grid.tickColor",type:"color"},"grid.outlineWidth","grid.verticalLines","grid.horizontalLines"]}),i.form.push({key:"xaxis",items:["xaxis.showLabels","xaxis.title",{key:"xaxis.color",type:"color"}]}),i.form.push({key:"yaxis",items:["yaxis.min","yaxis.max","yaxis.tickDecimals","yaxis.tickSize","yaxis.showLabels","yaxis.title",{key:"yaxis.color",type:"color"},{key:"yaxis.ticksFormatter",type:"javascript"}]}),"graph"!==t&&"bar"!==t||(i.groupInfoes=[{formIndex:0,GroupTitle:"Common Settings"}],i.form=[i.form],i.schema.properties=Object(s.a)(Object(s.a)(Object(s.a)({},i.schema.properties),a.schema.properties),n.schema.properties),i.schema.required=i.schema.required.concat(a.schema.required,n.schema.required),i.form.push(a.form,n.form),i.groupInfoes.push({formIndex:i.groupInfoes.length,GroupTitle:"Comparison Settings"}),i.groupInfoes.push({formIndex:i.groupInfoes.length,GroupTitle:"Custom Legend Settings"})),i}var a={schema:{title:"Comparison Settings",type:"object",properties:{comparisonEnabled:{title:"Enable comparison",type:"boolean",default:!1},timeForComparison:{title:"Time to show historical data",type:"string",default:"previousInterval"},xaxisSecond:{title:"Second X axis",type:"object",properties:{axisPosition:{title:"Axis position",type:"string",default:"top"},showLabels:{title:"Show labels",type:"boolean",default:!0},title:{title:"Axis title",type:"string",default:null}}}},required:[]},form:["comparisonEnabled",{key:"timeForComparison",type:"rc-select",multiple:!1,items:[{value:"previousInterval",label:"Previous interval (default)"},{value:"days",label:"Day ago"},{value:"weeks",label:"Week ago"},{value:"months",label:"Month ago"},{value:"years",label:"Year ago"}]},{key:"xaxisSecond",items:[{key:"xaxisSecond.axisPosition",type:"rc-select",multiple:!1,items:[{value:"top",label:"Top (default)"},{value:"bottom",label:"Bottom"}]},"xaxisSecond.showLabels","xaxisSecond.title"]}]},n={schema:{title:"Custom Legend Settings",type:"object",properties:{customLegendEnabled:{title:"Enable custom legend (this will allow you to use attribute/timeseries values in key labels)",type:"boolean",default:!1},dataKeysListForLabels:{title:"Datakeys list to use in labels",type:"array",items:{type:"object",properties:{name:{title:"Key name",type:"string"},type:{title:"Key type",type:"string",default:"attribute"}},required:["name"]}}},required:[]},form:["customLegendEnabled",{key:"dataKeysListForLabels",condition:"model.customLegendEnabled === true",items:[{key:"dataKeysListForLabels[].type",type:"rc-select",multiple:!1,items:[{value:"attribute",label:"Attribute"},{value:"timeseries",label:"Timeseries"}]},"dataKeysListForLabels[].name"]}]},l={schema:{type:"object",title:"Settings",properties:{radius:{title:"Radius",type:"number",default:1},innerRadius:{title:"Inner radius",type:"number",default:0},tilt:{title:"Tilt",type:"number",default:1},animatedPie:{title:"Enable pie animation (experimental)",type:"boolean",default:!1},stroke:{title:"Stroke",type:"object",properties:{color:{title:"Color",type:"string",default:""},width:{title:"Width (pixels)",type:"number",default:0}}},showLabels:{title:"Show labels",type:"boolean",default:!1},fontColor:{title:"Font color",type:"string",default:"#545454"},fontSize:{title:"Font size",type:"number",default:10}},required:[]},form:["radius","innerRadius","animatedPie","tilt",{key:"stroke",items:[{key:"stroke.color",type:"color"},"stroke.width"]},"showLabels",{key:"fontColor",type:"color"},"fontSize"]},r={schema:{type:"object",title:"DataKeySettings",properties:{hideDataByDefault:{title:"Data is hidden by default",type:"boolean",default:!1},disableDataHiding:{title:"Disable data hiding",type:"boolean",default:!1},removeFromLegend:{title:"Remove datakey from legend",type:"boolean",default:!1}},required:[]},form:["hideDataByDefault","disableDataHiding","removeFromLegend"]};function h(t,i){var e={schema:{type:"object",title:"DataKeySettings",properties:{excludeFromStacking:{title:'Exclude from stacking(available in "Stacking" mode)',type:"boolean",default:!1},hideDataByDefault:{title:"Data is hidden by default",type:"boolean",default:!1},disableDataHiding:{title:"Disable data hiding",type:"boolean",default:!1},removeFromLegend:{title:"Remove datakey from legend",type:"boolean",default:!1},showLines:{title:"Show lines",type:"boolean",default:t},fillLines:{title:"Fill lines",type:"boolean",default:!1},showPoints:{title:"Show points",type:"boolean",default:!1},showPointShape:{title:"Select point shape:",type:"string",default:"circle"},pointShapeFormatter:{title:"Point shape format function, f(ctx, x, y, radius, shadow)",type:"string",default:"var size = radius * Math.sqrt(Math.PI) / 2;\nctx.moveTo(x - size, y - size);\nctx.lineTo(x + size, y + size);\nctx.moveTo(x - size, y + size);\nctx.lineTo(x + size, y - size);"},showPointsLineWidth:{title:"Line width of points",type:"number",default:5},showPointsRadius:{title:"Radius of points",type:"number",default:3},tooltipValueFormatter:{title:"Tooltip value format function, f(value)",type:"string",default:""},showSeparateAxis:{title:"Show separate axis",type:"boolean",default:!1},axisMin:{title:"Minimum value on the axis scale",type:"number",default:null},axisMax:{title:"Maximum value on the axis scale",type:"number",default:null},axisTitle:{title:"Axis title",type:"string",default:""},axisTickDecimals:{title:"Axis tick number of digits after floating point",type:"number",default:null},axisTickSize:{title:"Axis step size between ticks",type:"number",default:null},axisPosition:{title:"Axis position",type:"string",default:"left"},axisTicksFormatter:{title:"Ticks formatter function, f(value)",type:"string",default:""}},required:["showLines","fillLines","showPoints"]},form:["hideDataByDefault","disableDataHiding","removeFromLegend","excludeFromStacking","showLines","fillLines","showPoints",{key:"showPointShape",type:"rc-select",multiple:!1,items:[{value:"circle",label:"Circle"},{value:"cross",label:"Cross"},{value:"diamond",label:"Diamond"},{value:"square",label:"Square"},{value:"triangle",label:"Triangle"},{value:"custom",label:"Custom function"}]},{key:"pointShapeFormatter",type:"javascript"},"showPointsLineWidth","showPointsRadius",{key:"tooltipValueFormatter",type:"javascript"},"showSeparateAxis","axisMin","axisMax","axisTitle","axisTickDecimals","axisTickSize",{key:"axisPosition",type:"rc-select",multiple:!1,items:[{value:"left",label:"Left"},{value:"right",label:"Right"}]},{key:"axisTicksFormatter",type:"javascript"}]},s=e.schema.properties;return"graph"!==i&&"bar"!==i||(s.thresholds={title:"Thresholds",type:"array",items:{title:"Threshold",type:"object",properties:{thresholdValueSource:{title:"Threshold value source",type:"string",default:"predefinedValue"},thresholdEntityAlias:{title:"Thresholds source entity alias",type:"string"},thresholdAttribute:{title:"Threshold source entity attribute",type:"string"},thresholdValue:{title:"Threshold value (if predefined value is selected)",type:"number"},lineWidth:{title:"Line width",type:"number"},color:{title:"Color",type:"string"}}},required:[]},e.form.push({key:"thresholds",items:[{key:"thresholds[].thresholdValueSource",type:"rc-select",multiple:!1,items:[{value:"predefinedValue",label:"Predefined value (Default)"},{value:"entityAttribute",label:"Value taken from entity attribute"}]},"thresholds[].thresholdValue","thresholds[].thresholdEntityAlias","thresholds[].thresholdAttribute",{key:"thresholds[].color",type:"color"},"thresholds[].lineWidth"]}),s.comparisonSettings={title:"Comparison Settings",type:"object",properties:{showValuesForComparison:{title:"Show historical values for comparison",type:"boolean",default:!0},comparisonValuesLabel:{title:"Historical values label",type:"string",default:""},color:{title:"Color",type:"string",default:""}},required:["showValuesForComparison"]},e.form.push({key:"comparisonSettings",items:["comparisonSettings.showValuesForComparison","comparisonSettings.comparisonValuesLabel",{key:"comparisonSettings.color",type:"color"}]})),e}},bOIV:function(t,i,e){"use strict";e.r(i),(function(t){e.d(i,"TbFlot",(function(){return f}));var s=e("//Q6"),o=e("0lYY"),a=e("RV8Q"),n=e("wd/R"),l=e("Zss7"),r=e("aX2P"),h=e("OiFK"),p=e("3Tyt"),d=l,u=n,c=a.c,m=a.b,f=function(){function i(i,e){this.ctx=i,this.chartType=e,this.plotInited=!1,this.isMouseInteraction=!1,this.flotHoverHandler=this.onFlotHover.bind(this),this.flotSelectHandler=this.onFlotSelect.bind(this),this.dblclickHandler=this.onFlotDblClick.bind(this),this.mousedownHandler=this.onFlotMouseDown.bind(this),this.mouseupHandler=this.onFlotMouseUp.bind(this),this.mouseleaveHandler=this.onFlotMouseLeave.bind(this),this.flotClickHandler=this.onFlotClick.bind(this),this.chartType=this.chartType||"line",this.settings=i.settings,this.utils=this.ctx.$injector.get(h.a),this.tooltip=t("#flot-series-tooltip"),0===this.tooltip.length&&(this.tooltip=this.createTooltipElement()),this.trackDecimals=i.decimals,this.trackUnits=i.units,this.tooltipIndividual="pie"===this.chartType||!!Object(s.n)(this.settings.tooltipIndividual)&&this.settings.tooltipIndividual,this.tooltipCumulative=!!Object(s.n)(this.settings.tooltipCumulative)&&this.settings.tooltipCumulative,this.hideZeros=!!Object(s.n)(this.settings.hideZeros)&&this.settings.hideZeros;var o={color:this.settings.fontColor||"#545454",size:this.settings.fontSize||10,family:"Roboto"};if(this.options={title:null,subtitile:null,shadowSize:Object(s.n)(this.settings.shadowSize)?this.settings.shadowSize:4,HtmlText:!1,grid:{hoverable:!0,mouseActiveRadius:10,autoHighlight:!0===this.tooltipIndividual,markings:[]},selection:{mode:"x"},legend:{show:!1}},"line"===this.chartType||"bar"===this.chartType||"state"===this.chartType){if(this.options.xaxes=[],this.xaxis={mode:"time",timezone:"browser",font:Object(s.e)(o),labelFont:Object(s.e)(o)},this.yaxis={font:Object(s.e)(o),labelFont:Object(s.e)(o)},this.settings.xaxis&&(this.xaxis.font.color=this.settings.xaxis.color||this.xaxis.font.color,this.xaxis.label=this.utils.customTranslation(this.settings.xaxis.title,this.settings.xaxis.title)||null,this.xaxis.labelFont.color=this.xaxis.font.color,this.xaxis.labelFont.size=this.xaxis.font.size+2,this.xaxis.labelFont.weight="bold"),this.yAxisTickFormatter=this.formatYAxisTicks.bind(this),this.yaxis.tickFormatter=this.yAxisTickFormatter,this.settings.yaxis&&(this.yaxis.font.color=this.settings.yaxis.color||this.yaxis.font.color,this.yaxis.min=Object(s.n)(this.settings.yaxis.min)?this.settings.yaxis.min:null,this.yaxis.max=Object(s.n)(this.settings.yaxis.max)?this.settings.yaxis.max:null,this.yaxis.label=this.utils.customTranslation(this.settings.yaxis.title,this.settings.yaxis.title)||null,this.yaxis.labelFont.color=this.yaxis.font.color,this.yaxis.labelFont.size=this.yaxis.font.size+2,this.yaxis.labelFont.weight="bold",Object(s.v)(this.settings.yaxis.tickSize)?this.yaxis.tickSize=this.settings.yaxis.tickSize:this.yaxis.tickSize=null,Object(s.v)(this.settings.yaxis.tickDecimals)?this.yaxis.tickDecimals=this.settings.yaxis.tickDecimals:this.yaxis.tickDecimals=null,this.settings.yaxis.ticksFormatter&&this.settings.yaxis.ticksFormatter.length))try{this.yaxis.ticksFormatterFunction=new Function("value",this.settings.yaxis.ticksFormatter)}catch(a){this.yaxis.ticksFormatterFunction=null}this.options.grid.borderWidth=1,this.options.grid.color=this.settings.fontColor||"#545454",this.settings.grid&&(this.options.grid.color=this.settings.grid.color||"#545454",this.options.grid.backgroundColor=this.settings.grid.backgroundColor||null,this.options.grid.tickColor=this.settings.grid.tickColor||"#DDDDDD",this.options.grid.borderWidth=Object(s.n)(this.settings.grid.outlineWidth)?this.settings.grid.outlineWidth:1,!1===this.settings.grid.verticalLines&&(this.xaxis.tickLength=0),!1===this.settings.grid.horizontalLines&&(this.yaxis.tickLength=0),Object(s.n)(this.settings.grid.margin)&&(this.options.grid.margin=this.settings.grid.margin),Object(s.n)(this.settings.grid.minBorderMargin)&&(this.options.grid.minBorderMargin=this.settings.grid.minBorderMargin)),this.options.xaxes[0]=Object(s.e)(this.xaxis),this.settings.xaxis&&!1===this.settings.xaxis.showLabels&&(this.options.xaxes[0].tickFormatter=function(){return""}),this.options.series={},this.options.crosshair={mode:"x"},"line"===this.chartType&&this.settings.smoothLines&&(this.options.series.curvedLines={active:!0,monotonicFit:!0}),"line"===this.chartType&&isFinite(this.settings.thresholdsLineWidth)&&(this.options.grid.markingsLineWidth=this.settings.thresholdsLineWidth),"bar"===this.chartType&&(this.options.series.lines={show:!1,fill:!1,steps:!1},this.options.series.bars={show:!0,lineWidth:0,fill:.9,align:this.settings.barAlignment||"left"},this.defaultBarWidth=this.settings.defaultBarWidth||600),"state"===this.chartType&&(this.options.series.lines={steps:!0,show:!0})}else"pie"===this.chartType&&(this.options.series={pie:{show:!0,label:{show:!0===this.settings.showLabels},radius:this.settings.radius||1,innerRadius:this.settings.innerRadius||0,stroke:{color:"#fff",width:0},tilt:this.settings.tilt||1,shadow:{left:5,top:15,alpha:.02}}},this.options.grid.clickable=!0,this.settings.stroke&&(this.options.series.pie.stroke.color=this.settings.stroke.color||"#fff",this.options.series.pie.stroke.width=this.settings.stroke.width||0),this.options.series.pie.label.show&&(this.options.series.pie.label.formatter=function(t,i){return"<div class='pie-label'>"+i.dataKey.label+"<br/>"+Math.round(i.percent)+"%</div>"},this.options.series.pie.label.radius=3/4,this.options.series.pie.label.background={opacity:.8}),this.animatedPie=!0===this.settings.animatedPie);this.ctx.defaultSubscription&&this.init(this.ctx.$container,this.ctx.defaultSubscription)}return i.pieSettingsSchema=function(){return c},i.pieDatakeySettingsSchema=function(){return m},i.settingsSchema=function(t){return Object(a.d)(t)},i.datakeySettingsSchema=function(t,i){return Object(a.a)(t,i)},i.prototype.init=function(t,i){var e,a,n=this;if(this.$element=t,this.subscription=i,this.comparisonEnabled=this.subscription?this.subscription.comparisonEnabled:this.settings.comparisonEnabled,this.comparisonEnabled){var l=Object(s.e)(this.xaxis);l.position="top",this.settings.xaxisSecond&&(!1===this.settings.xaxisSecond.showLabels&&(l.tickFormatter=function(){return""}),l.label=this.utils.customTranslation(this.settings.xaxisSecond.title,this.settings.xaxisSecond.title)||null,l.position=this.settings.xaxisSecond.axisPosition),l.tickLength=0,this.options.xaxes.push(l),this.options.series.stack=!1}else this.options.series.stack=!0===this.settings.stack;var h=[];this.yaxes=[];var u={},c=[],m=[];if(this.settings.customLegendEnabled&&(null===(e=this.settings.dataKeysListForLabels)||void 0===e?void 0:e.length)){this.labelPatternsSourcesData=[];var f=[];this.settings.dataKeysListForLabels.forEach((function(t){t.settings={}})),this.subscription.datasources.forEach((function(t){var i={type:t.type,entityType:t.entityType,entityId:t.entityId,dataKeys:n.settings.dataKeysListForLabels};f.push(i)})),this.subscribeForLabelPatternsSources(f)}var y=null;if(this.settings.tooltipValueFormatter&&this.settings.tooltipValueFormatter.length)try{y=new Function("value",this.settings.tooltipValueFormatter)}catch(L){y=null}for(var b=0;b<this.subscription.data.length;b++){var g=this.subscription.data[b];h.push(g.dataKey.color);var x=g.dataKey.settings;if(g.dataKey.tooltipValueFormatFunction=y,x.tooltipValueFormatter&&x.tooltipValueFormatter.length)try{g.dataKey.tooltipValueFormatFunction=new Function("value",x.tooltipValueFormatter)}catch(L){g.dataKey.tooltipValueFormatFunction=y}if(g.lines={fill:!0===x.fillLines},this.settings.stack&&!this.comparisonEnabled?g.stack=!x.excludeFromStacking:g.stack=!1,"line"===this.chartType||"state"===this.chartType?g.lines.show=!1!==x.showLines:g.lines.show=!0===x.showLines,Object(s.n)(x.lineWidth)&&null!==x.lineWidth&&(g.lines.lineWidth=x.lineWidth),g.points={show:!1,radius:8},!0===x.showPoints&&(g.points.show=!0,g.points.lineWidth=Object(s.n)(x.showPointsLineWidth)?x.showPointsLineWidth:5,g.points.radius=Object(s.n)(x.showPointsRadius)?x.showPointsRadius:3,g.points.symbol=Object(s.n)(x.showPointShape)?x.showPointShape:"circle","custom"===g.points.symbol&&x.pointShapeFormatter))try{g.points.symbol=new Function("ctx, x, y, radius, shadow",x.pointShapeFormatter)}catch(L){g.points.symbol="circle"}"line"===this.chartType&&this.settings.smoothLines&&!g.points.show&&(g.curvedLines={apply:!0});var v=d(g.dataKey.color);if(v.setAlpha(.75),g.highlightColor=v.toRgbString(),g.datasource.isAdditional?(g.xaxisIndex=1,g.xaxis=2):(g.xaxisIndex=0,g.xaxis=1),this.yaxis){var k=g.dataKey.units&&g.dataKey.units.length?g.dataKey.units:this.trackUnits,T=void 0;if(x.showSeparateAxis?(T=this.createYAxis(x,k),this.yaxes.push(T)):(T=u[k])||(T=this.createYAxis(x,k),u[k]=T,this.yaxes.push(T)),g.yaxisIndex=this.yaxes.indexOf(T),g.yaxis=g.yaxisIndex+1,T.keysInfo[b]={hidden:!1},T.show=!0,x.thresholds&&x.thresholds.length)for(var w=function(t){if("predefinedValue"===t.thresholdValueSource&&isFinite(t.thresholdValue)){var i=D.subscription.data.length+c.length;D.generateThreshold(c,g.yaxis,t.lineWidth,t.color,i,t.thresholdValue)}else if(t.thresholdEntityAlias&&t.thresholdAttribute){var e=D.ctx.aliasController.getEntityAliasId(t.thresholdEntityAlias);if(!e)return"continue";var s=m.filter((function(t){return t.entityAliasId===e}))[0],a={type:p.h.attribute,name:t.thresholdAttribute,label:t.thresholdAttribute,settings:{yaxis:g.yaxis,lineWidth:t.lineWidth,color:t.color},_hash:Math.random()};s?s.dataKeys.push(a):(s={type:o.a.entity,name:t.thresholdEntityAlias,aliasName:t.thresholdEntityAlias,entityAliasId:e,dataKeys:[a]},m.push(s))}},D=this,F=0,S=x.thresholds;F<S.length;F++){w(S[F])}}(null===(a=this.labelPatternsSourcesData)||void 0===a?void 0:a.length)&&this.substituteLabelPatterns(g,b)}if(this.subscribeForThresholdsAttributes(m),this.options.grid.markings=c,this.predefinedThresholds=c,this.options.colors=h,this.options.yaxes=Object(s.e)(this.yaxes),"line"!==this.chartType&&"bar"!==this.chartType&&"state"!==this.chartType||("bar"===this.chartType&&(this.subscription.timeWindowConfig.aggregation&&this.subscription.timeWindowConfig.aggregation.type===r.a.NONE?this.options.series.bars.barWidth=this.defaultBarWidth:this.options.series.bars.barWidth=.6*this.subscription.timeWindow.interval),this.options.xaxes[0].min=this.subscription.timeWindow.minTime,this.options.xaxes[0].max=this.subscription.timeWindow.maxTime,this.comparisonEnabled&&(this.options.xaxes[1].min=this.subscription.comparisonTimeWindow.minTime,this.options.xaxes[1].max=this.subscription.comparisonTimeWindow.maxTime)),this.checkMouseEvents(),this.plot&&this.plot.destroy(),"pie"===this.chartType&&this.animatedPie){this.pieDataAnimationDuration=250,this.pieData=Object(s.e)(this.subscription.data),this.pieRenderedData=[],this.pieTargetData=[];for(b=0;b<this.subscription.data.length;b++)this.pieTargetData[b]=this.subscription.data[b].data&&this.subscription.data[b].data[0]?this.subscription.data[b].data[0][1]:0;this.pieDataRendered()}this.plotInited=!0,this.createPlot()},i.prototype.update=function(){var t,i=this;if(this.updateTimeoutHandle&&(clearTimeout(this.updateTimeoutHandle),this.updateTimeoutHandle=null),this.subscription)if(!this.isMouseInteraction&&this.plot)if("line"===this.chartType||"bar"===this.chartType||"state"===this.chartType){var e=!1;if(this.yaxis){for(var s=0;s<this.subscription.data.length;s++){var o=this.subscription.data[s],a=o.yaxisIndex;this.yaxes[a].keysInfo[s].hidden!==o.dataKey.hidden&&(this.yaxes[a].keysInfo[s].hidden=o.dataKey.hidden,e=!0),(null===(t=this.labelPatternsSourcesData)||void 0===t?void 0:t.length)&&this.substituteLabelPatterns(o,s)}e&&(this.options.yaxes.length=0,this.yaxes.forEach((function(t){var e=!0;t.keysInfo.forEach((function(t){t&&(e=e&&t.hidden)})),t.hidden=e;var s=1;t.hidden||(i.options.yaxes.push(t),s=i.options.yaxes.length);for(var o=0;o<t.keysInfo.length;o++)t.keysInfo[o]&&(i.subscription.data[o].yaxis=s)})),this.options.yaxis={show:!!this.options.yaxes.length})}this.options.xaxes[0].min=this.subscription.timeWindow.minTime,this.options.xaxes[0].max=this.subscription.timeWindow.maxTime,this.comparisonEnabled&&(this.options.xaxes[1].min=this.subscription.comparisonTimeWindow.minTime,this.options.xaxes[1].max=this.subscription.comparisonTimeWindow.maxTime),"bar"===this.chartType&&(this.subscription.timeWindowConfig.aggregation&&this.subscription.timeWindowConfig.aggregation.type===r.a.NONE?this.options.series.bars.barWidth=this.defaultBarWidth:this.options.series.bars.barWidth=.6*this.subscription.timeWindow.interval),e?this.redrawPlot():(this.plot.getOptions().xaxes[0].min=this.subscription.timeWindow.minTime,this.plot.getOptions().xaxes[0].max=this.subscription.timeWindow.maxTime,this.comparisonEnabled&&(this.plot.getOptions().xaxes[1].min=this.subscription.comparisonTimeWindow.minTime,this.plot.getOptions().xaxes[1].max=this.subscription.comparisonTimeWindow.maxTime),"bar"===this.chartType&&(this.subscription.timeWindowConfig.aggregation&&this.subscription.timeWindowConfig.aggregation.type===r.a.NONE?this.plot.getOptions().series.bars.barWidth=this.defaultBarWidth:this.plot.getOptions().series.bars.barWidth=.6*this.subscription.timeWindow.interval),this.updateData())}else"pie"===this.chartType&&(this.animatedPie?this.nextPieDataAnimation(!0):this.updateData());else this.isMouseInteraction&&this.plot&&(this.updateTimeoutHandle=setTimeout(this.update.bind(this),30))},i.prototype.resize=function(){if(this.resizeTimeoutHandle&&(clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=null),this.plot&&this.plotInited){var t=this.$element.width(),i=this.$element.height();t&&i?(this.plot.resize(),"pie"!==this.chartType&&this.plot.setupGrid(),this.plot.draw()):this.resizeTimeoutHandle=setTimeout(this.resize.bind(this),30)}},i.prototype.checkMouseEvents=function(){var t=!this.ctx.isEdit;(Object(s.z)(this.mouseEventsEnabled)||this.mouseEventsEnabled!==t)&&(this.mouseEventsEnabled=t,this.$element&&(t?this.enableMouseEvents():this.disableMouseEvents(),this.redrawPlot()))},i.prototype.destroy=function(){this.cleanup(),this.tooltip&&(this.tooltip.stop(!0),this.tooltip.hide()),this.plot&&(this.plot.destroy(),this.plot=null,this.plotInited=!1)},i.prototype.cleanup=function(){this.updateTimeoutHandle&&(clearTimeout(this.updateTimeoutHandle),this.updateTimeoutHandle=null),this.createPlotTimeoutHandle&&(clearTimeout(this.createPlotTimeoutHandle),this.createPlotTimeoutHandle=null),this.resizeTimeoutHandle&&(clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=null)},i.prototype.createPlot=function(){if(this.createPlotTimeoutHandle&&(clearTimeout(this.createPlotTimeoutHandle),this.createPlotTimeoutHandle=null),this.plotInited&&!this.plot){var i=this.$element.width(),e=this.$element.height();i&&e?"pie"===this.chartType&&this.animatedPie?this.plot=t.plot(this.$element,this.pieData,this.options):this.plot=t.plot(this.$element,this.subscription.data,this.options):this.createPlotTimeoutHandle=setTimeout(this.createPlot.bind(this),30)}},i.prototype.updateData=function(){this.plot.setData(this.subscription.data),"pie"!==this.chartType&&this.plot.setupGrid(),this.plot.draw()},i.prototype.redrawPlot=function(){this.plot&&this.plotInited&&(this.plot.destroy(),this.plot=null,this.createPlot())},i.prototype.createYAxis=function(t,i){var e,o,a=Object(s.e)(this.yaxis),n=t.axisTitle&&t.axisTitle.length?t.axisTitle:a.label;e=Object(s.v)(t.axisTickDecimals)?t.axisTickDecimals:a.tickDecimals,o=Object(s.v)(t.axisTickSize)?t.axisTickSize:a.tickSize;var l=t.axisPosition&&t.axisPosition.length?t.axisPosition:"left",r=Object(s.n)(t.axisMin)?t.axisMin:a.min,h=Object(s.n)(t.axisMax)?t.axisMax:a.max;if(a.label=n,a.min=r,a.max=h,a.tickUnits=i,a.tickDecimals=e,a.tickSize=o,a.alignTicksWithAxis="right"===l&&null===o?1:null,a.position=l,a.keysInfo=[],t.axisTicksFormatter&&t.axisTicksFormatter.length)try{a.ticksFormatterFunction=new Function("value",t.axisTicksFormatter)}catch(p){a.ticksFormatterFunction=this.yaxis.ticksFormatterFunction}return a},i.prototype.subscribeForThresholdsAttributes=function(t){var i=this,e={datasources:t,useDashboardTimewindow:!1,type:o.k.latest,callbacks:{onDataUpdated:function(t){return i.thresholdsSourcesDataUpdated(t.data)}}};this.ctx.subscriptionApi.createSubscription(e,!0).subscribe((function(t){i.thresholdsSourcesSubscription=t}))},i.prototype.thresholdsSourcesDataUpdated=function(t){var i=this,e=Object(s.e)(this.predefinedThresholds);t.forEach((function(t){if(t&&t.data&&t.data[0]){var s=t.data[0][1];if(isFinite(s)){var o=t.dataKey.settings,a=i.subscription.data.length+e.length;i.generateThreshold(e,o.yaxis,o.lineWidth,o.color,a,s)}}})),this.options.grid.markings=e,this.redrawPlot()},i.prototype.generateThreshold=function(t,i,e,o,a,n){var l,r={};l=1!==i?"y"+i+"axis":"yaxis",isFinite(e)&&(r.lineWidth=e),Object(s.n)(o)?r.color=o:r.color=this.utils.getMaterialColor(a),r[l]={from:n,to:n},t.filter((function(t){return Object(s.r)(t[l],r[l])})).length||t.push(r)},i.prototype.subscribeForLabelPatternsSources=function(t){var i=this,e={datasources:t,useDashboardTimewindow:!1,type:o.k.latest,callbacks:{onDataUpdated:function(t){i.labelPatternsParamsDataUpdated(t.data)}}};this.ctx.subscriptionApi.createSubscription(e,!0).subscribe((function(t){i.labelPatternsSourcesSubscription=t}))},i.prototype.labelPatternsParamsDataUpdated=function(t){this.labelPatternsSourcesData=t;for(var i=0;i<this.subscription.data.length;i++){var e=this.subscription.data[i];this.substituteLabelPatterns(e,i)}this.updateData(),this.ctx.detectChanges()},i.prototype.substituteLabelPatterns=function(t,i){for(var e=this.labelPatternsSourcesData.filter((function(i){return i.datasource.entityId===t.datasource.entityId})),o=Object(s.d)(t.datasource,t.dataKey.pattern),a=0;a<e.length;a++){var n=e[a];if(n&&n.data&&n.data[0]){var l=n.data[0][1],r=n.dataKey.name;Object(s.n)(l)&&null!==l&&(o=Object(s.m)(o,r,l))}}if(Object(s.n)(this.subscription.legendData)){var h=this.subscription.legendData.keys.findIndex((function(t){return t.dataIndex===i}));-1!==h&&(this.subscription.legendData.keys[h].dataKey.label=o)}t.dataKey.label=o},i.prototype.seriesInfoDiv=function(i,e,o,a,n,l,r,h){var p=t("<div></div>");p.css({display:"flex",alignItems:"center",justifyContent:"space-between"});var d=t("<span></span>");d.css({backgroundColor:e,width:"20px",height:"3px",display:"inline-block",verticalAlign:"middle",marginRight:"5px"}),p.append(d);var u,c=t("<span>"+i+":</span>");c.css({marginRight:"10px"}),l&&c.css({color:"#FFF",fontWeight:"700"}),p.append(c),u=h?h(o):this.ctx.utils.formatValue(o,n,a),Object(s.v)(r)&&(u+=" ("+Math.round(r)+" %)");var m=t("<span>"+u+"</span>");return m.css({marginLeft:"auto",fontWeight:"700"}),l&&m.css({color:"#FFF"}),p.append(m),p},i.prototype.seriesInfoDivFromInfo=function(t,i){var e=t.units&&t.units.length?t.units:this.trackUnits,o=Object(s.o)(t.decimals)?t.decimals:this.trackDecimals;return this.seriesInfoDiv(t.label,t.color,t.value,e,o,t.index===i,null,t.tooltipValueFormatFunction).prop("outerHTML")},i.prototype.createTooltipElement=function(){var i=t('<div id="flot-series-tooltip" class="flot-mouse-value"></div>');return i.css({fontSize:"12px",fontFamily:"Roboto",fontWeight:"300",lineHeight:"18px",opacity:"1",backgroundColor:"rgba(0,0,0,0.7)",color:"#D9DADB",position:"absolute",display:"none",zIndex:"1100",padding:"4px 10px",borderRadius:"4px"}).appendTo("body"),i},i.prototype.formatPieTooltip=function(t){var i=t.series.dataKey.units&&t.series.dataKey.units.length?t.series.dataKey.units:this.trackUnits,e=Object(s.o)(t.series.dataKey.decimals)?t.series.dataKey.decimals:this.trackDecimals;return this.seriesInfoDiv(t.series.dataKey.label,t.series.dataKey.color,t.datapoint[1][0][1],i,e,!0,t.series.percent,t.series.dataKey.tooltipValueFormatFunction).prop("outerHTML")},i.prototype.formatChartTooltip=function(i,e){var o=this,a="";if(this.tooltipIndividual){var n=(i[1]&&i[1].seriesHover.length?i[0].seriesHover.concat(i[1].seriesHover):i[0].seriesHover).filter((function(t){return t.index===e}));if(n&&n.length){var l=parseInt(n[0].time,10),r=u(l).format("YYYY-MM-DD HH:mm:ss"),h=t("<div>"+r+"</div>");h.css({display:"flex",alignItems:"center",justifyContent:"center",padding:"4px",fontWeight:"700"}),a+=h.prop("outerHTML"),a+=this.seriesInfoDivFromInfo(n[0],e)}}else{var p;p=i[1]&&i[1].seriesHover.length?5:15;var d=0;d=i[1]&&i[1].seriesHover.length>i[0].seriesHover.length?Math.ceil(i[1].seriesHover.length/p):Math.ceil(i[0].seriesHover.length/p),i.forEach((function(i){if(Object(s.v)(i.time)){var n="",l=parseInt(i.time,10),r=u(l).format("YYYY-MM-DD HH:mm:ss"),h=t("<div>"+r+"</div>");h.css({display:"flex",alignItems:"center",justifyContent:"center",padding:"4px",fontWeight:"700"}),a+=h.prop("outerHTML");var c=t("<div></div>");c.css({display:"flex",flexDirection:"row"});for(var m=0;m<d;m++){var f=t("<div></div>");f.css({display:"flex",flexDirection:"column",flex:"1"});for(var y="",b=m*p;b<(m+1)*p&&!(b>=i.seriesHover.length);b++){var g=i.seriesHover[b];y+=o.seriesInfoDivFromInfo(g,e)}f.html(y),y&&(m>0&&(n+='<span style="min-width: 20px;"></span>'),n+=f.prop("outerHTML"))}c.html(n),a+=c.prop("outerHTML")}}))}return a},i.prototype.formatYAxisTicks=function(t,i){if(this.settings.yaxis&&!1===this.settings.yaxis.showLabels)return"";if(i.options.ticksFormatterFunction)return i.options.ticksFormatterFunction(t);var e=i.options.tickDecimals?Math.pow(10,i.options.tickDecimals):1,o=""+Math.round(t*e)/e;if(Object(s.n)(i.options.tickDecimals)&&null!==i.options.tickDecimals){var a=o.indexOf("."),n=-1===a?0:o.length-a-1;n<i.options.tickDecimals&&(o=(n?o:o+".")+(""+e).substr(1,i.options.tickDecimals-n))}return i.options.tickUnits&&(o+=" "+i.options.tickUnits),o},i.prototype.enableMouseEvents=function(){this.$element.css("pointer-events",""),this.$element.addClass("mouse-events"),this.options.selection={mode:"x"},this.$element.bind("plothover",this.flotHoverHandler),this.$element.bind("plotselected",this.flotSelectHandler),this.$element.bind("dblclick",this.dblclickHandler),this.$element.bind("mousedown",this.mousedownHandler),this.$element.bind("mouseup",this.mouseupHandler),this.$element.bind("mouseleave",this.mouseleaveHandler),this.$element.bind("plotclick",this.flotClickHandler)},i.prototype.disableMouseEvents=function(){this.$element.css("pointer-events","none"),this.$element.removeClass("mouse-events"),this.options.selection={mode:null},this.$element.unbind("plothover",this.flotHoverHandler),this.$element.unbind("plotselected",this.flotSelectHandler),this.$element.unbind("dblclick",this.dblclickHandler),this.$element.unbind("mousedown",this.mousedownHandler),this.$element.unbind("mouseup",this.mouseupHandler),this.$element.unbind("mouseleave",this.mouseleaveHandler),this.$element.unbind("plotclick",this.flotClickHandler)},i.prototype.onFlotHover=function(i,e,o){var a=this;if(this.plot)if(this.tooltipIndividual&&!o||this.ctx.isEdit)this.tooltip.stop(!0),this.tooltip.hide(),this.plot.unhighlight();else{var n=!this.tooltipIndividual;n&&this.plot.unhighlight();var l=e.pageX,r=e.pageY,h=void 0,p=void 0;if("pie"===this.chartType?h=this.formatPieTooltip(o):(p=this.getHoverInfo(this.plot.getData(),e),(Object(s.v)(p[0].time)||p[1]&&Object(s.v)(p[1].time))&&(p[0].seriesHover.sort((function(t,i){return i.value-t.value})),p[1]&&p[1].seriesHover.length&&p[1].seriesHover.sort((function(t,i){return i.value-t.value})),h=this.formatChartTooltip(p,o?o.seriesIndex:-1))),h){this.tooltip.html(h).css({top:0,left:0}).fadeIn(200);var d=t(window).width(),u=t(window).height(),c=this.tooltip.width(),m=this.tooltip.height(),f=l+5,y=r+5;d-l<c+50&&(f=l-c-10),u-r<m+20&&(y=r-m-10),this.tooltip.css({top:y,left:f}),n&&p.forEach((function(t){t.seriesHover.forEach((function(t){a.plot.highlight(t.index,t.hoverIndex)}))}))}}},i.prototype.onFlotSelect=function(t,i){this.plot&&(this.plot.clearSelection(),this.subscription.onUpdateTimewindow(i.xaxis.from,i.xaxis.to))},i.prototype.onFlotDblClick=function(){this.subscription.onResetTimewindow()},i.prototype.onFlotMouseDown=function(){this.isMouseInteraction=!0},i.prototype.onFlotMouseUp=function(){this.isMouseInteraction=!1},i.prototype.onFlotMouseLeave=function(){this.tooltip&&(this.tooltip.stop(!0),this.tooltip.hide(),this.plot&&this.plot.unhighlight(),this.isMouseInteraction=!1)},i.prototype.onFlotClick=function(t,i,e){this.plot&&this.onPieSliceClick(t,e)},i.prototype.getHoverInfo=function(t,i){var e,s,o,a,n,l,r,h,p,d,u,c=0,m=0,f=[{seriesHover:[]}];for(this.comparisonEnabled&&f.push({seriesHover:[]}),"bar"===this.chartType&&"left"!==this.options.series.bars.align&&(m="center"===this.options.series.bars.align?this.options.series.bars.barWidth/2:this.options.series.bars.barWidth),e=0;e<t.length;e++){var y=void 0;y=(s=t[e]).datasource.isAdditional?i.x2:i.x,y+=m,o=this.findHoverIndexFromData(y,s),s.data[o]&&s.data[o][0]&&(a=y-s.data[o][0],l=s.data[o][0],s.datasource.isAdditional?(!u||a>=0&&(a<u||u<0)||a<0&&a>u)&&(u=a,h=l):(!n||a>=0&&(a<n||n<0)||a<0&&a>n)&&(n=a,r=l),d=s.stack?this.tooltipIndividual||!this.tooltipCumulative?s.data[o][1]:c+=s.data[o][1]:s.data[o][1],(s.stack||s.curvedLines&&s.curvedLines.apply)&&(o=this.findHoverIndexFromDataPoints(y,s,o)),this.hideZeros&&!d||(p={value:d,hoverIndex:o,color:s.dataKey.color,label:s.dataKey.label,units:s.dataKey.units,decimals:s.dataKey.decimals,tooltipValueFormatFunction:s.dataKey.tooltipValueFormatFunction,time:l,distance:a,index:e},s.datasource.isAdditional?f[1].seriesHover.push(p):f[0].seriesHover.push(p)))}return f[1]&&f[1].seriesHover.length&&(f[1].time=h),f[0].time=r,f},i.prototype.findHoverIndexFromData=function(t,i){for(var e,s=0,o=i.data.length-1;;){if(s>o)return Math.max(o,0);if(e=Math.floor((s+o)/2),i.data[e][0]===t)return e;i.data[e][0]<t?s=e+1:o=e-1}},i.prototype.findHoverIndexFromDataPoints=function(t,i,e){var s,o=i.datapoints.pointsize,a=e*o,n=i.datapoints.points.length;for(s=a;s<n;s+=o)if(!i.lines.steps&&null!=i.datapoints.points[a]&&null==i.datapoints.points[s]||i.datapoints.points[s]>t)return Math.max(s-o,0)/o;return s/o-1},i.prototype.pieDataRendered=function(){for(var t=0;t<this.pieTargetData.length;t++){var i=this.pieTargetData[t]?this.pieTargetData[t]:0;this.pieRenderedData[t]=i,this.pieData[t].data[0]||(this.pieData[t].data[0]=[0,0]),this.pieData[t].data[0][1]=i}},i.prototype.nextPieDataAnimation=function(t){if(t){this.finishPieDataAnimation(),this.pieAnimationStartTime=this.pieAnimationLastTime=Date.now();for(var i=0;i<this.subscription.data.length;i++)this.pieTargetData[i]=this.subscription.data[i].data&&this.subscription.data[i].data[0]?this.subscription.data[i].data[0][1]:0}this.pieAnimationCaf&&(this.pieAnimationCaf(),this.pieAnimationCaf=null),this.pieAnimationCaf=this.ctx.$scope.raf.raf(this.onPieDataAnimation.bind(this))},i.prototype.onPieDataAnimation=function(){var t=Date.now(),i=t-this.pieAnimationLastTime,e=(t-this.pieAnimationStartTime)/this.pieDataAnimationDuration;if(e>=1)this.finishPieDataAnimation();else{if(i>=40){for(var s=0;s<this.pieTargetData.length;s++){var o=this.pieRenderedData[s],a=o+(this.pieTargetData[s]-o)*e;this.pieData[s].data[0]||(this.pieData[s].data[0]=[0,0]),this.pieData[s].data[0][1]=a}this.plot.setData(this.pieData),this.plot.draw(),this.pieAnimationLastTime=t}this.nextPieDataAnimation(!1)}},i.prototype.finishPieDataAnimation=function(){this.pieDataRendered(),this.plot.setData(this.pieData),this.plot.draw()},i.prototype.onPieSliceClick=function(t,i){var e=this.ctx.actionsApi.getActionDescriptors("sliceClick");if(t&&e.length){t.stopPropagation();var s=this.ctx.actionsApi.getActiveEntityInfo(),o=s?s.entityId:null,a=s?s.entityName:null,n=s?s.entityLabel:null;this.ctx.actionsApi.handleWidgetAction(t,e[0],o,a,i,n)}},i}()}).call(this,e("xexB"))}}]);